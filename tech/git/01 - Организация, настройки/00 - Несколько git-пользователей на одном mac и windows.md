SSH можно использовать не только в случае, когда надо пользоваться несколькими git-аккаунтами на одном компьютере, но и просто чтобы клонировать репозитории через SSH-протокол.

# Mac

## Создаем ключи

Нужно создать для каждого аккаунта ssh-ключ.

* Создаем папку `.ssh` в корневой директории своего юзера (если она еще не существует):

  ```
  mkdir ~/.ssh
  ```

* Переходим в эту папку:

  ```
  cd ~/.ssh
  ```

* Создаем по паре ключей (приватный и публичный) для каждого аккаунта:

  ```
  ssh-keygen -t ed25519 -C "github acc for programming" -f "git-for-programming"
  // и для второго, третьего все аналогично
  ```

  * `-C` - просто комментарий, с описанием для чего предназначен ключ.
  * `-f` - имя файла, в который ключ будет сохранен. Пригодится дальше, так что лучше дать осмысленное название.

  После ввода команды терминал попросит задать кодовую фразу (пароль). Если задать, тогда при установлении соединения в сессии надо будет этот пароль ввести. Защита на случай, если ключ спиздят. Без ввода пароля ключом не удастся воспользоваться. Если не задавать, тогда не надо будет вводить пароль в сессии.

  Каждая команда создаст два файла - с публичным ключом (заканчивается на `.pub`) и приватным.

## Добавляем приватные ключи в SSH Agent

* Добавляем приватные ключи в агент, указывая имя файла (которое без `.pub`):

  ```
  ssh-add -K ~/.ssh/git-for-programming
  аналогично для остальных приватных ключей
  ```

## Добавляем публичные ключи в git-аккаунт

* Копируем *публичный* ключ (тот что с `.pub` в конце имени файла) в буфер обмена такой командой:

  ```
  pbcopy < ~/.ssh/git-for-programming.pub
  ```

* Логинимся в гит-аккаунт.

* Жмем на свой аватар в правом верхнем углу и переходим в `Settings`.

* Там ищем в левом меню пункт `SSH and GPG keys`.

* Жмем кнопку `New SSH key`.

* Вводим произвольное имя для ключа, вставляем сам ключ в нужное поле и жмем кнопку Add.

  * В конце ключа будет комментарий (тот который мы сами писали при создании). Можно сохранять прямо с ним, а можно удалить. Если оставить, то гитхаб возьмет его в качестве title для ключа.

* Повторяем для остальных аккаунтов и ключей.

## Создаем файл конфига SSH Agent

* Создаем файл конфига (если он еще не создан):

  ```
  touch ~/.ssh/config
  ```

* Открываем его:

  ```
  open ~/.ssh/config
  ```

* Вводим конфиг для всех аккаунтов:

  ```
  # Аккаунт для программирования
  Host github.com-programming
       HostName github.com
       User git
       IdentityFile ~/.ssh/git-for-programming
       
  # Аккаунт НЕ для программирования
  # аналогично, только Host указываем другой, например, github.com-no-programming
  # Ну и файл с приватным ключом конечно же тоже другой.
  ```

  - Здесь в первой строке нужно задать идентификатор, который понадобится в будущем при клонировании репозиториев, так что имя надо дать хорошее.
    - `github.com-programming` возможно сложновато выглядит, можно проще, например, `prog`, но так как будто более наглядно, что за сайт и для каких целей
  
  - В IdentityFile задаем файл с *приватным* ключом.

## Клонируем репозитории, используя нужные аккаунты

* Теперь надо склонировать репозитории, воспользовавшись созданными аккаунтами:

  ```
  git clone git@github.com-programming:johnydotsville/a-notes.git
  ```

  Здесь после `@` мы указываем идентификатор, под которым добавляли настройки в config-файл из прошлого шага (Host). Соответственно, клонировать репозиторий надо через тот идентификатор, под которым указан соответствующий приватный ключ.

  После `:` указывается реальное имя гит-юзера и репозиторий.

  При первом клонировании может ругаться что невозможно установить соединение и спросит, надо ли продолжать. Отвечаем yes, надо, и после этого все будет нормально.

* Настраиваем имя пользователя и почту, которые будут вставлены в коммиты:

  ```
  git config user.name "имяПользователя"
  git config user.email "почта@домен.ru"
  ```

* Все, можно коммитить и пушить.



# Windows

## Создаем ключи

Желательно делать через git bash (устанавливается вместе с git по умолчанию), чтобы пути до папки ssh было проще указывать. Если делать через обычную консоль, тогда `.ssh` папка должна быть в папке пользователя, например `C:\users\johny`

```
ssh-keygen -t ed25519 -C "johny@email" -f ~/.ssh/id_ed25519_johny
```

- Значения параметров произвольные, главное чтобы удобно было их различать самому. Тот что id_ed25519_johny влияет на имя будущего файла с ключом.
- Генерируем несколько ключей, по количеству пользователей.

## Добавляем приватные ключи в SSH агент

Запускаем агент:

```
eval "$(ssh-agent -s)"
```

Добавляем приватные ключи:

```
ssh-add ~/.ssh/id_ed25519_johny
```

## Добавляем публичные ключи в git-аккаунты

- Заходим в свою папку пользователя, например `C:\users\johny`, ищем в ней папку `.ssh`, там будут пары приватные ключи + публичные (.pub на конце)
- Берем публичный ключ целиком (но без пробелов в конце), выглядит примерно так:

 ```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIN5yHzUoJkXZe4iBqE4ysfFv2dS7OymsEtH7o/9XVr6Y mynameisjohny
 ```

и вставляем в гит-аккаунт, как в разделе про mac уже написано. Может потребоваться подтверждение через email. Там в конце идет комментарий, можно его не копировать.

### Создаем файл конфига SSH Agent

В .ssh папке создать файл `config` (без расширения):

```
Host github-foobar
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_johny


Host github-zxcqwe
  HostName github.com
  User git
  IdentityFile ~/.ssh/ssh_id_тутвторой
```

В первой строке нужно задать идентификатор (параметр Host), который понадобится в будущем при клонировании репозиториев, так что имя надо дать хорошее. В IdentityFile задаем файл с *приватным* ключом, из первого шага.

## Клонируем репозитории

Так же как в [разделе про mac](#клонируем-репозитории-используя-нужные-аккаунты)